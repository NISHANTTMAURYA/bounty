{% extends 'dev/base.html' %}

{% block title %}{{ project.title }} - Project Details{% endblock %}

{% block content %}
<div class="project-detail-container">
    <div class="project-header">
        <h1>{{ project.title }}</h1>
        <span class="status-badge status-{{ project.status }}">
            {{ project.get_status_display }}
        </span>
    </div>

    <div class="project-info">
        <div class="info-section">
            <h2>Project Details</h2>
            <div class="detail-grid">
                <div class="detail-item">
                    <strong>Client</strong>
                    <span>{{ project.client }}</span>
                </div>
                <div class="detail-item">
                    <strong>Budget</strong>
                    <span>${{ project.budget }}</span>
                </div>
                <div class="detail-item">
                    <strong>Duration</strong>
                    <span>{{ project.duration }} days</span>
                </div>
                <div class="detail-item">
                    <strong>Created</strong>
                    <span>{{ project.created_at|date:"M d, Y" }}</span>
                </div>
            </div>
        </div>

        <div class="info-section">
            <h2>Description</h2>
            <p>{{ project.description }}</p>
        </div>

        <div class="info-section">
            <h2>Required Skills</h2>
            <div class="skills-list">
                {% for skill in project.required_skills.all %}
                    <span class="skill-tag">{{ skill.name }}</span>
                {% endfor %}
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Frame handling functions
            function handleFrameLoad() {
                const frame = document.getElementById('previewFrame');
                if (frame) {
                    frame.style.display = 'block';
                    const errorDiv = frame.nextElementSibling;
                    if (errorDiv && errorDiv.className === 'preview-error') {
                        errorDiv.remove();
                    }
                }
            }

            function handleFrameError() {
                const frame = document.getElementById('previewFrame');
                if (frame) {
                    frame.style.display = 'none';
                    
                    if (!frame.nextElementSibling || !frame.nextElementSibling.classList.contains('preview-error')) {
                        const errorDiv = document.createElement('div');
                        errorDiv.className = 'preview-error';
                        errorDiv.innerHTML = 'Preview not available';
                        frame.parentNode.insertBefore(errorDiv, frame.nextSibling);
                    }
                }
            }

            // Add frame error handler if frame exists
            const previewFrame = document.getElementById('previewFrame');
            if (previewFrame) {
                previewFrame.addEventListener('error', handleFrameError);
            }

            // Edit form handling
            const editBtn = document.getElementById('editProjectBtn');
            const editForm = document.getElementById('editProjectForm');
            const projectInfo = document.querySelector('.project-info');

            function toggleEditForm() {
                if (editForm && projectInfo) {
                    if (editForm.style.display === 'none') {
                        editForm.style.display = 'block';
                        projectInfo.style.display = 'none';
                    } else {
                        editForm.style.display = 'none';
                        projectInfo.style.display = 'block';
                    }
                }
            }

            // Add edit button click handler
            if (editBtn && editForm && projectInfo) {
                editBtn.addEventListener('click', toggleEditForm);
            }

            // Form submission handling
            const form = document.querySelector('.edit-form form');
            if (form) {
                form.addEventListener('submit', function(e) {
                    const submitBtn = form.querySelector('button[type="submit"]');
                    if (submitBtn) {
                        submitBtn.disabled = true;
                        submitBtn.textContent = 'Saving...';
                    }
                });
            }
        });
    </script>
</body>
</html>